# 访问控制系统 - 未实现功能分析

基于对Project.pdf项目要求的分析和当前代码库实现情况的对比，以下是尚未完善或尚未实现的功能列表。

## 1. CSV日志系统（完全缺失）

**PDF要求**：
- 日志必须以CSV格式存储
- 按日/月/年组织文件结构（如 `2025/Dec/24.csv`）
- 特定格式：`2025,Dec,24,Wed,14:36:49,BX76Z541,BR59KA87,R7U39PL2,83746028,John:Doe,GRANTED`
- 目录结构：年文件夹 > 月文件夹 > 日文件

**现状**：
- 日志仅存储在数据库（`LogEntry`实体）
- `LogServiceImpl`只保存到数据库，无CSV导出
- `LogQueryServiceImpl`从缓存查询，无CSV生成逻辑

**缺失功能**：
- CSV文件生成器（按PDF指定格式）
- 按日/月/年的目录结构自动管理
- 实时日志写入CSV文件（当前仅写数据库）
- 日志搜索结果的CSV导出功能
- 历史CSV文件的读取和解析

## 2. 时间过滤器完整实现（部分实现）

**PDF要求**：支持复杂时间规则，如：
- `"2025.July,August.Monday-Friday.8:00-12:00,14:00-17:00"`（多时间区间）
- `"2026.EXCEPT June,July,August.EXCEPT Sunday.ALL"`（EXCEPT排除逻辑）
- `"ALL.ALL.Monday-Friday.EXCEPT 12:00-14:00"`（组合逻辑）
- `"2026.January,March,May.Monday,Wednesday,Friday.16:00-18:00"`

**现状**：
- `TimeFilterServiceImpl`支持基础规则解析
- 支持单一年、月、星期、时间范围
- `TimeFilter`实体存储解析后的字段

**缺失功能**：
- EXCEPT（排除）逻辑支持
- 多时间区间支持（如 `8:00-12:00,14:00-17:00`）
- ALL.*通配符与EXCEPT的组合解析
- 复杂的月份、星期表示（如 `Monday,Wednesday,Friday`）
- 时间规则的完整验证和错误处理

## 3. 徽章更新机制完整流程（部分实现）

**PDF要求**：
- 读卡器支持两种操作模式：
  1. 刷卡(swipe) - 正常读取徽章
  2. 更新(hold) - 更新徽章代码（安全功能）
- 自动更新周期：徽章代码定期更新增强安全性
- 更新通知：显示"badge must be updated"消息
- 更新窗口：用户有限时间内必须更新，否则徽章失效

**现状**：
- 有`BadgeCodeUpdateService`接口定义
- 有徽章状态管理和过期检查的基础概念
- 徽章实体包含状态和过期相关信息

**缺失功能**：
- 读卡器UI的双模式操作界面
- 徽章过期自动检测和更新触发流程
- 用户更新通知和倒计时机制
- 更新失败后的徽章失效处理
- 徽章代码生成算法和安全策略
- 更新过程中的读卡器状态管理

## 4. 站点可视化完整功能（部分实现）

**PDF要求**：
- 使用提供的图像（`site-layout.png`, `office-layout.png`）
- 实时显示访问尝试（绿色/红色闪烁点表示允许/拒绝）
- 可缩放和导航的站点平面图
- 建筑、楼层、房间的层次化显示

**现状**：
- `SiteMapPanel`类有基础绘图功能
- 按资源状态显示不同颜色
- 简单的楼层分组显示
- 10秒自动刷新定时器

**缺失功能**：
- 未集成PDF提供的示例图像
- 无闪烁点表示实时访问事件
- 放大/缩小功能标记为"待实现"
- 缺少建筑/楼层导航
- 图像加载和坐标映射系统
- 实时事件可视化（绿色/红色闪烁）

## 5. 资源一键非受控状态（缺失）

**PDF要求**：
- 火灾疏散时，管理员可一键将选定资源组设置为UNCONTROLLED状态
- 批量状态设置功能
- 紧急控制界面

**现状**：
- `Resource`实体有`isControlled`字段
- 资源状态管理的基本框架
- 缺少批量控制和紧急界面

**缺失功能**：
- 资源组批量状态设置功能
- 紧急控制界面（UI面板）
- 一键设置所有门为UNCONTROLLED的快速操作
- 紧急状态恢复机制

## 6. 配置文件语法验证（需要验证）

**PDF要求**：
- 自定义语法存储组和配置文件
- 支持PDF中的复杂示例格式
- 文件持久化和加载机制

**现状**：
- `ProfileFileService`使用JSON格式
- `GroupFileService`使用自定义文本格式
- 文件加载和保存的基本框架

**需要验证**：
- 是否支持PDF示例中的所有时间过滤器语法
- 组文件的资源列表表示完整性
- 配置文件(组,时间过滤器)对的存储格式
- 文件语法与内存数据结构的转换效率

## 7. 事件模拟规模测试（需要验证）

**PDF要求**：
- 模拟300个徽章和400个读卡器的并发活动
- 可扩展的事件模拟系统
- 性能指标收集

**现状**：
- `EventSimulator`、`BadgeReaderSimulator`、`RouterSystem`接口
- 模拟器基础框架
- 性能统计收集机制

**需要验证**：
- 压力测试验证300/400规模性能
- 并发事件处理的稳定性
- 虚拟线程（PDF提到的）使用情况
- 系统资源占用和响应时间

## 8. 日志搜索GUI完整性（需要检查）

**PDF要求**：
- 图形界面支持动态过滤器搜索日志
- 灵活的搜索条件组合
- 搜索结果展示和导出

**现状**：
- `MonitorPanel`显示监控界面
- `LogQueryService`提供查询功能
- 基本的日志检索能力

**需要检查**：
- 所有搜索过滤器的UI实现完整性
- CSV导出功能是否集成
- 时间段选择器的易用性
- 复杂查询条件的组合支持

## 9. 数据库完整结构（基本实现）

**PDF要求表格**：
- ✓ employees（员工）
- ✓ badges（徽章）
- ✓ resources（资源）
- ✓ badge_readers（读卡器）
- ✓ groups（组）
- ✓ profiles（配置文件）
- ✓ time_filters（时间过滤器）
- ✓ 连接表（employee_groups, group_resources等）

**现状**：
- 所有核心实体已定义
- JPA关系映射基本完成
- 缓存层（LocalCacheManager）支持

**需要验证**：
- 所有外键关系和级联操作正确性
- 数据库索引和查询优化
- 数据一致性和完整性约束

## 额外发现：缺失图像资源

**PDF要求**：
- 使用`site-layout.png`和`office-layout.png`进行可视化
- 站点布局和办公室布局图像

**现状**：
- 项目目录中无任何图像文件
- `SiteMapPanel`使用程序化绘图而非真实图像

**缺失**：
- PDF提到的示例图像文件
- 图像加载和显示功能
- 图像坐标与资源位置的映射

## 优先级建议

### 高优先级（演示关键功能）
1. **CSV日志系统** - PDF明确要求，演示必备
2. **时间过滤器完整实现** - 核心功能，复杂规则支持

### 中优先级（用户体验和完整性）
3. **站点可视化** - 使用图像+闪烁点，视觉效果重要
4. **徽章更新UI集成** - 安全功能演示
5. **资源一键控制** - 紧急情况处理演示

### 低优先级（优化和扩展）
6. **配置文件语法扩展** - 功能完整性
7. **事件模拟规模优化** - 性能演示
8. **日志搜索GUI完善** - 用户体验优化

## 整体完成度评估

**核心访问控制逻辑**：约90%完成
- ✓ 徽章验证
- ✓ 权限检查（组-资源关系）
- ✓ 时间过滤器基础
- ✓ 访问次数限制
- ✓ 优先级规则（资源依赖）
- ✓ 缓存层优化

**演示关键功能**：约60%完成
- ✗ CSV日志系统
- ⚠ 复杂时间过滤器
- ⚠ 站点可视化（无图像）
- ⚠ 徽章更新流程

**UI/UX功能**：约70%完成
- ✓ 多标签管理界面
- ✓ 基础监控面板
- ⚠ 日志搜索功能
- ⚠ 可视化效果

**总体完成度**：约70-75%

## 建议的开发顺序

1. 首先实现CSV日志系统（演示必备）
2. 完善时间过滤器（支持PDF所有示例）
3. 添加图像资源并改进站点可视化
4. 实现徽章更新完整流程
5. 添加紧急控制功能
6. 进行大规模性能测试和优化
7. 完善UI细节和用户体验

---
*分析时间：2025年1月10日*
*基于Project.pdf要求和当前代码库状态*